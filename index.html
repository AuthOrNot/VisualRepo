<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rosslyn Metro Status</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #111;
      color: #fff;
      display: flex;
      flex-direction: row;
      height: 100vh;
      overflow: hidden;
    }
    #info {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    #info h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      color: #ffd100; /* WMATA Yellow */
    }
    #last-updated {
      font-size: 1em;
      color: #aaa;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1.6em;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #444;
      text-align: left;
    }
    th {
      background: #222;
      color: #ffd100;
    }
    .line-RED { color: #d71920; font-weight: bold; }
    .line-BLU { color: #0072ce; font-weight: bold; }
    .line-YEL { color: #ffd100; font-weight: bold; }
    .line-GRN { color: #00b140; font-weight: bold; }
    .line-ORG { color: #ff8200; font-weight: bold; }
    .line-SVR { color: #919d9d; font-weight: bold; }

    #map {
      flex: 1;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="info">
    <h1>Rosslyn Metro â€“ Next Trains</h1>
    <div id="last-updated">Loading...</div>
    <table>
      <thead>
        <tr>
          <th>Line</th>
          <th>Destination</th>
          <th>Arrival</th>
        </tr>
      </thead>
      <tbody id="train-data"></tbody>
    </table>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const apiKey = "15889836cf154bccb8fdfb9ba6b3420a";
    const stationCode = "C05"; // Rosslyn
    const stations = [
      { name: "Rosslyn", code: "C05", lat: 38.896595, lon: -77.07146 },
      { name: "Foggy Bottom", code: "C04", lat: 38.9007, lon: -77.0508 },
      { name: "Court House", code: "K01", lat: 38.8913, lon: -77.0837 },
      { name: "Arlington Cemetery", code: "C06", lat: 38.8846, lon: -77.0631 }
    ];

    async function fetchTrains() {
      const url = `https://api.wmata.com/StationPrediction.svc/json/GetPrediction/${stationCode}`;
      const response = await fetch(url, {
        headers: { "api_key": apiKey }
      });
      const data = await response.json();

      const tableBody = document.getElementById("train-data");
      tableBody.innerHTML = "";

      data.Trains.slice(0, 6).forEach(train => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="line-${train.Line}">${train.Line}</td>
          <td>${train.Destination}</td>
          <td>${train.Min}</td>
        `;
        tableBody.appendChild(row);
      });

      document.getElementById("last-updated").innerText =
        "Last updated: " + new Date().toLocaleTimeString();
    }

    // Init map
    const map = L.map('map').setView([38.896595, -77.07146], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Add station markers
    stations.forEach(station => {
      L.marker([station.lat, station.lon])
        .addTo(map)
        .bindPopup(`<b>${station.name}</b>`);
    });

    // Initial fetch and repeat
    fetchTrains();
    setInterval(fetchTrains, 30000);
  </script>
</body>
</html>
